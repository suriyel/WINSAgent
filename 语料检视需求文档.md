# Product Requirement Specification (Spec) - 电信网规网优智能语料检索系统

## 1. 业务目标 (Objective)

- **解决什么问题？**

  为电信网规网优专家提供高精度的专业知识检索服务，消除通用大模型的“幻觉”问题，确保所有回答均有据可查、术语定义严谨，并支持复杂文档（含图表）的段落级溯源。

- **成功指标是什么？**

  - **术语一致性**：核心术语 100% 匹配语料库定义。
  - **溯源可靠性**：点击引用标签可 100% 精准定位并高亮显示超大 Markdown 片段。
  - **交付质量**：支持 Word/PDF/PPT/Excel 全量转化为标准化 Markdown 语料。

## 2. 功能清单 (Features)

| **模块**               | **功能描述**             | **验收标准 (AC)**                                            | **优先级** |
| ---------------------- | ------------------------ | ------------------------------------------------------------ | ---------- |
| **全量构建流水线**     | 异构文档转 MD 及索引构建 | 采用 Docling 引擎。全量更新时先清空索引，再执行解析、切片与入库，构建期间不提供查询。 | P0         |
| **简化 Excel 转化**    | Excel 转结构化 MD 表格   | 使用 Pandas 将 Sheet 记录转为 Standard Markdown Table，保留行列关系。 | P1         |
| **高精度检索 (FAISS)** | 向量检索 + 关键词 Rerank | 基于 FAISS 实现向量检索，并通过 BGE-Reranker 结合专家词表强制重排，确保术语完全匹配。 | P0         |
| **超大 MD 预览/定位**  | 虚拟滚动预览与锚点跳转   | 支持 10MB+ 的 MD 文件，点击引用自动跳转至段落锚点，并对匹配关键词进行背景高亮。 | P0         |
| **图文关联系统**       | 图片相对位置保持与引用   | 提取文档图片并保留其在 MD 中的占位符。生成的总结报告需在相应结论后自动附带图片引用。 | P1         |
| **专家治理入口**       | KG/词表 Schema 上传      | 支持 JSON/CSV 上传电信专用术语库与同义词映射表，作为 Rerank 的核心干预依据。 | P1         |

## 3. 技术约束与集成 (Technical Constraints)

- **数据流向**：

  `源文件 -> Docling 解析 -> Markdown (含图片占位) -> 段落切片 -> 向量化 (Embedding) -> FAISS 索引`。

- **三方件选型**：

  - **解析引擎**：**Docling** (高性能布局分析及 MD 转化)。
  - **向量库**：**FAISS** (Local Index，支持 Flat/HNSW 索引)。
  - **重排序**：**BGE-Reranker-v2-m3** (针对中文及专业术语微调)。
  - **推理/多模态**：**Qwen2-VL** (用于图片理解及报告生成，不涉及离线 OCR)。
  - **前端**：React-Markdown + 虚拟列表组件。

- **异常处理逻辑**：

  - **解析失败**：若文件损坏或格式不支持，流水线记录 Error 日志并跳过，不中断全量构建。
  - **检索无果**：若 Rerank 分数低于阈值，系统需明确提示“语料库中未找到相关准确依据”，拒绝臆断。

## 4. 非功能性需求

- **性能要求**：几百份文档规模下，全量构建时长需可控；用户查询到报告生成的端到端响应 < 10s。
- **安全性/权限控制**：内部专家治理系统需进行身份鉴权；语料库物理存储需加密。
- **超大文件处理**：前端必须采用虚拟滚动（Virtual Scrolling），严禁一次性加载完整 MD 文件的 DOM 节点。

## 5. 未决/待定事项 (TBD)

- **图片展示策略**：由于不执行离线 OCR，图片搜索完全依赖于 MD 上下文描述，需在专家治理环节关注图片上下文的描述质量。
- **索引存储**：FAISS 索引文件是需要持久化为二进制文件随镜像发布。

## 6.性能规格要求

Top3 Precision ≥ **80%**

错误引用率 ≤ **8%**

P95 查询延迟 ≤ **5s**

拒答准确率 ≥ **95%**（无证据不生成）